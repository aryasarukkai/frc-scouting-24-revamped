<!DOCTYPE html>
<html>
<head>
   <title>Scouting App</title>
   <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
   <link rel="icon" type="image/x-icon" href="icon.png">
   <style>
       @import url('https://fonts.googleapis.com/css?family=Archivo+Black');
       @import url('https://fonts.googleapis.com/css?family=Red+Hat+Display:900');

       body {
           font-family: 'Red Hat Display', sans-serif;
           margin: 20px;
           background-color: #001F3F;
           color: #FFFFFF;
       }
       .input-group label {
           font-family: 'Archivo Black', sans-serif;
           color: #FFFFFF;
           margin-bottom: 5px;
       }

       input[type="text"], input[type="number"], input[type="checkbox"], input[type="radio"], button {
           font-family: 'Red Hat Display', sans-serif;
           color: #FFFFFF;
           background-color: #555;
           border: 1px solid #777;
           border-radius: 4px;
           padding: 10px;
           margin-bottom: 10px;
       }
       button {
           font-weight: 900;
           text-transform: uppercase;
           border: 2px solid #FFFFFF;
           background-color: transparent;
           cursor: pointer;
       }
       button:hover {
           background-color: #FFFFFF;
           color: #333;
       }
       input[type="checkbox"], input[type="radio"] {
           transform: scale(1.2);
           margin-right: 5px;
       }
       .input-group div {
           margin-bottom: 10px;
       }
       .input-group label {
           display: inline-block;
           margin-right: 20px;
       }
   </style>
</head>
<body>
   <h1>649 Scouting [WEB]</h1>
   <h2>FRC Crescendo</h2>
   <div class="input-group">
       <label for="scout_name">Scout Name:</label>
       <input type="text" id="scout_name" required>
   </div>
   <div class="input-group">
       <label for="match_number">Match Number:</label>
       <input type="number" id="match_number" required>
   </div>
   <div class="input-group">
       <label for="team_number">Team Number:</label>
       <input type="number" id="team_number" required>
   </div>
   <div class="input-group">
       <label for="alliance_color">Alliance Color:</label>
       <div>
           <input type="radio" id="alliance_color_red" name="alliance_color" value="red" required>
           <label for="alliance_color_red">Red</label>
           <input type="radio" id="alliance_color_blue" name="alliance_color" value="blue" required>
           <label for="alliance_color_blue">Blue</label>
       </div>
   </div>
   <div class="input-group">
       <label>Timer:</label>
       <div>
           <button id="start_stop" onclick="startStopTimer()">Start</button>
           <button id="reset" onclick="resetTimer()">Reset</button>
           <span id="timer">0:15</span>
       </div>
   </div>
   <div id="auton_section">
       <div class="input-group">
           <label>Auton:</label>
           <div>
               <button onclick="selectSource('ground', true)">GROUND</button>
           </div>
       </div>
       <div class="input-group">
           <div>
               <button onclick="selectSource('amp', true)">AMP</button>
               <button onclick="selectSource('speaker', true)">SPEAKER</button>
           </div>
       </div>
       <div class="input-group">
           <div>
               <button onclick="scoreNote(true)">SCORE</button>
               <button onclick="failNote(true)">FAIL</button>
               <button onclick="undoLastScore(true)">UNDO LAST SCORE</button>
           </div>
       </div>
       <div class="input-group">
           <label>Scored:</label>
           <div>
               <span id="scored_amps_auton">Amps: 0</span>
               <span id="scored_speakers_auton">Speakers: 0</span>
           </div>
       </div>
   </div>
   <div id="teleop_section" style="display: none;">
       <div class="input-group">
           <label>Teleop:</label>
           <div>
               <button onclick="selectSource('source', false)">SOURCE</button>
               <button onclick="selectSource('ground', false)">GROUND</button>
               <button onclick="selectSource('amplify', false)">AMPLIFY</button>
           </div>
       </div>
       <div class="input-group">
           <div>
               <button onclick="selectSource('amp', false)">AMP</button>
               <button onclick="selectSource('speaker', false)">SPEAKER</button>
           </div>
       </div>
       <div class="input-group">
           <div>
               <button onclick="scoreNote(false)">SCORE</button>
               <button onclick="failNote(false)">FAIL</button>
               <button onclick="undoLastScore(false)">UNDO LAST SCORE</button>
           </div>
       </div>
       <div class="input-group">
           <label>Scored:</label>
           <div>
               <span id="scored_amps_teleop">Amps: 0</span>
               <span id="scored_speakers_teleop">Speakers: 0</span>
           </div>
       </div>
   </div>
   <div class="input-group">
       <label for="notes">Notes:</label>
       <input type="text" id="notes" required>
   </div>
   <div class="input-group">
       <label for="list">List:</label>
       <textarea id="list" rows="5" readonly></textarea>
   </div>
   <button onclick="submitData()">Save Locally</button>
   <button onclick="uploadData()">Upload</button>

   <script>
       let selectedSource = '';
       let isAuton = true;
       let scoredAmpsAuton = 0;
       let scoredSpeakersAuton = 0;
       let scoredAmpsTeleop = 0;
       let scoredSpeakersTeleop = 0;
       let list = '';
       let timerInterval;
       let timeLeft = 15; // 15 seconds for Auton

       function selectSource(source, isAutonMode) {
           selectedSource = source;
           isAuton = isAutonMode;
           if (isAuton) {
               timeLeft = 15;
               document.getElementById('timer').textContent = '0:15';
           } else {
               timeLeft = 135; // 2 minutes and 15 seconds for Teleop
               document.getElementById('timer').textContent = '2:15';
           }
       }

       function scoreNote(isAutonMode) {
           const currentTime = formatTime(timeLeft);
           let scoredNote = '';

           if (selectedSource === 'ground' && isAutonMode) {
               scoredNote = 'scored in amp ' + currentTime;
               scoredAmpsAuton++;
               document.getElementById('scored_amps_auton').textContent = `Amps: ${scoredAmpsAuton}`;
           } else if (selectedSource === 'amp' && isAutonMode) {
               scoredNote = 'scored in amp ' + currentTime;
               scoredAmpsAuton++;
               document.getElementById('scored_amps_auton').textContent = `Amps: ${scoredAmpsAuton}`;
           } else if (selectedSource === 'speaker' && isAutonMode) {
               scoredNote = 'scored in speaker ' + currentTime;
               scoredSpeakersAuton++;
               document.getElementById('scored_speakers_auton').textContent = `Speakers: ${scoredSpeakersAuton}`;
           } else if (selectedSource === 'source' && !isAutonMode) {
               if (selectedSource === 'amplify') {
                   scoredNote = 'scored in amplified speaker ' + currentTime;
                   scoredSpeakersTeleop++;
                   document.getElementById('scored_speakers_teleop').textContent = `Speakers: ${scoredSpeakersTeleop}`;
               } else {
                   scoredNote = 'scored in speaker ' + currentTime;
                   scoredSpeakersTeleop++;
                   document.getElementById('scored_speakers_teleop').textContent = `Speakers: ${scoredSpeakersTeleop}`;
               }
           } else if (selectedSource === 'amp' && !isAutonMode) {
               scoredNote = 'scored in amp ' + currentTime;
               scoredAmpsTeleop++;
               document.getElementById('scored_amps_teleop').textContent = `Amps: ${scoredAmpsTeleop}`;
           }

           if (scoredNote) {
               list += ', ' + scoredNote;
               document.getElementById('list').value = list;
           }

           selectedSource = '';
       }

       function failNote(isAutonMode) {
           const currentTime = formatTime(timeLeft);
           let failedNote = '';

           if (selectedSource === 'amp' && isAutonMode) {
               failedNote = 'failed in amp ' + currentTime;
           } else if (selectedSource === 'speaker' && isAutonMode) {
               failedNote = 'failed in speaker ' + currentTime;
           } else if (selectedSource === 'amp' && !isAutonMode) {
               failedNote = 'failed in amp ' + currentTime;
           } else if (selectedSource === 'speaker' && !isAutonMode) {
               failedNote = 'failed in speaker ' + currentTime;
           }

           if (failedNote) {
               list += ', ' + failedNote;
               document.getElementById('list').value = list;
           }

           selectedSource = '';
       }

       function undoLastScore(isAutonMode) {
           if (isAutonMode) {
               if (scoredAmpsAuton > 0) {
                   scoredAmpsAuton--;
                   document.getElementById('scored_amps_auton').textContent = `Amps: ${scoredAmpsAuton}`;
               } else if (scoredSpeakersAuton > 0) {
                   scoredSpeakersAuton--;
                   document.getElementById('scored_speakers_auton').textContent = `Speakers: ${scoredSpeakersAuton}`;
               }
           } else {
               if (scoredAmpsTeleop > 0) {
                   scoredAmpsTeleop--;
                   document.getElementById('scored_amps_teleop').textContent = `Amps: ${scoredAmpsTeleop}`;
               } else if (scoredSpeakersTeleop > 0) {
                   scoredSpeakersTeleop--;
                   document.getElementById('scored_speakers_teleop').textContent = `Speakers: ${scoredSpeakersTeleop}`;
               }
           }

           const lastScoreIndex = list.lastIndexOf(',');
           if (lastScoreIndex !== -1) {
               list = list.slice(0, lastScoreIndex);
               document.getElementById('list').value = list;
           }
       }

       function formatTime(timeInSeconds) {
           const minutes = Math.floor(timeInSeconds / 60);
           const seconds = timeInSeconds % 60;
           return `${minutes}:${seconds.toString().padStart(2, '0')}`;
       }

       function startStopTimer() {
           const startStopButton = document.getElementById('start_stop');
           if (startStopButton.textContent === 'Start') {
               startStopButton.textContent = 'Stop';
               timerInterval = setInterval(updateTimer, 1000);
           } else {
               startStopButton.textContent = 'Start';
               clearInterval(timerInterval);
           }
       }

       function resetTimer() {
           clearInterval(timerInterval);
           document.getElementById('start_stop').textContent = 'Start';
           if (isAuton) {
               timeLeft = 15;
               document.getElementById('timer').textContent = '0:15';
           } else {
               timeLeft = 135;
               document.getElementById('timer').textContent = '2:15';
           }
       }

       function updateTimer() {
           if (timeLeft > 0) {
               timeLeft--;
               document.getElementById('timer').textContent = formatTime(timeLeft);
           } else {
               clearInterval(timerInterval);
               document.getElementById('start_stop').textContent = 'Start';
               alert('Time's up!');
           }
       }

       function submitData() {
           const formData = {
               scoutName: document.getElementById("scout_name").value,
               matchNumber: document.getElementById("match_number").value,
               teamNumber: document.getElementById("team_number").value,
               allianceColor: document.querySelector('input[name="alliance_color"]:checked').value,
               scoredAmpsAuton: scoredAmpsAuton,
               scoredSpeakersAuton: scoredSpeakersAuton,
               scoredAmpsTeleop: scoredAmpsTeleop,
               scoredSpeakersTeleop: scoredSpeakersTeleop,
               notes: document.getElementById("notes").value,
               list: list
           };

           localStorage.setItem("formData", JSON.stringify(formData));
           alert("Data saved locally successfully!");
       }

       function uploadData() {
           const formData = JSON.parse(localStorage.getItem("formData"));

           if (!formData) {
               alert("No data to upload. Please save data locally first.");
               return;
           }

           const url = `https://script.google.com/macros/s/AKfycbw6GYL5Vqa3Bo3DiBoRnBx6yvVRvbLR_fkUfnFIANa7Q1seGizskp69DBASKm5p9qo2/exec?action=create&name=${formData.scoutName}&matchnumber=${formData.matchNumber}&teamnumber=${formData.teamNumber}&color=${formData.allianceColor}&scoredampsauton=${formData.scoredAmpsAuton}&scoredspeakersauton=${formData.scoredSpeakersAuton}&scoredampsteleop=${formData.scoredAmpsTeleop}&scoredspeakersteleop=${formData.scoredSpeakersTeleop}&notes=${formData.notes}&list=${formData.list}`;

           fetch(url)
               .then(response => response.text())
               .then(data => {
                   alert(`Data uploaded successfully: ${data}`);
                   localStorage.removeItem("formData");
               })
               .catch(error => {
                   alert(`Data upload failed: ${error}`);
               });
       }

       window.addEventListener('load', () => {
           if ('serviceWorker' in navigator) {
               navigator.serviceWorker.register('/service-worker.js')
                   .then(registration => {
                       console.log('Service Worker registered successfully:', registration);
                   })
                   .catch(error => {
                       console.error('Service Worker registration failed:', error);
                   });
           }
       });
   </script>
</body>
</html>
